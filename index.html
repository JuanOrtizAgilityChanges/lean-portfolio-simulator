<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Lean Portfolio Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos adicionales para animaciones */
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .transition-all {
            transition: all 0.3s ease;
        }
        
        .transition-colors {
            transition: color 0.3s ease, background-color 0.3s ease;
        }
        
        /* Estilos para scrollbar */
        .overflow-y-auto::-webkit-scrollbar {
            width: 8px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Estilos para inputs range */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #f59e0b;
            border-radius: 50%;
            cursor: pointer;
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #f59e0b;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-7xl mx-auto p-6 bg-gray-50 min-h-screen">
        <!-- Header -->
        <div class="mb-8 text-center">
            <div class="mb-4">
                <div class="text-4xl font-black text-amber-500 mb-2" style="letter-spacing: 0.1em;">
                    AGILITY CHANGES
                </div>
                <div class="text-sm text-amber-600 font-medium">Simulador de Portafolio Lean</div>
            </div>
            <h1 class="text-2xl font-bold text-gray-900 mb-2">
                Simulador Lean Portfolio Management - Versi√≥n Educativa
            </h1>
            <p class="text-gray-600 max-w-3xl mx-auto mb-4">
                Gestiona un portafolio de iniciativas bajo presi√≥n, eventos impredecibles y restricciones reales. 
                Aprende principios Lean mientras optimizas valor, costo y sostenibilidad del equipo.
            </p>
            
            <!-- Objetivo del Juego -->
            <div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-lg p-6 max-w-4xl mx-auto">
                <div class="flex items-center justify-center mb-4">
                    <svg class="text-amber-600 mr-2" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
                        <path d="M14 9h1.5a2.5 2.5 0 0 1 0 5H14"/>
                        <path d="M6 2v6"/>
                        <path d="M14 2v6"/>
                        <path d="M6 16v6"/>
                        <path d="M14 16v6"/>
                        <path d="M6 16h8"/>
                        <path d="M6 9h8"/>
                    </svg>
                    <h2 class="text-xl font-bold text-amber-900">OBJETIVO DEL DESAF√çO</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                    <div class="bg-white rounded-lg p-4 border border-amber-100">
                        <div class="text-2xl font-bold text-amber-600">410</div>
                        <div class="text-sm text-gray-600">Valor de Negocio</div>
                        <div class="text-xs text-gray-500">Meta a alcanzar (90% del portafolio)</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 border border-amber-100">
                        <div class="text-2xl font-bold text-amber-600">6</div>
                        <div class="text-sm text-gray-600">Meses</div>
                        <div class="text-xs text-gray-500">Tiempo l√≠mite para completar</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 border border-amber-100">
                        <div class="text-2xl font-bold text-amber-600">$50,000</div>
                        <div class="text-sm text-gray-600">Presupuesto</div>
                        <div class="text-xs text-gray-500">L√≠mite mensual estricto</div>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <div class="text-lg font-medium text-amber-600" id="objectiveStatus">
                        üéØ 0% del objetivo completado
                    </div>
                    <div class="text-sm text-gray-600 mt-1" id="progressInfo">
                        Progreso: 0/410 | Mes: 1/6
                    </div>
                </div>
            </div>
        </div>

        <!-- Instrucciones -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-6" id="instructionsPanel">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center">
                    <svg class="text-yellow-600 mr-2" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 16v-4"/>
                        <path d="M12 8h.01"/>
                    </svg>
                    <h3 class="font-bold text-yellow-900">C√ìMO USAR EL SIMULADOR</h3>
                </div>
                <button onclick="hideInstructions()" class="text-yellow-600 hover:text-yellow-800 text-xl">
                    ‚úï
                </button>
            </div>
            
            <div class="bg-white p-4 rounded-lg border border-yellow-200 mb-4">
                <h4 class="font-bold text-yellow-900 mb-3">üéØ Es muy simple - solo sigue estos pasos:</h4>
                <div class="space-y-3 text-sm text-yellow-800">
                    <div class="flex items-start space-x-3">
                        <div class="bg-yellow-900 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">1</div>
                        <div>
                            <strong class="text-yellow-900">Configura tu equipo</strong>
                            <p class="text-xs mt-1">Ajusta tama√±o, horas y l√≠mite de WIP con los deslizadores</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="bg-yellow-900 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">2</div>
                        <div>
                            <strong class="text-yellow-900">Prioriza iniciativas</strong>
                            <p class="text-xs mt-1">Usa las flechas ‚Üë‚Üì para ordenar por valor estrat√©gico</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="bg-yellow-900 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">3</div>
                        <div>
                            <strong class="text-yellow-900">Ejecuta el mes</strong>
                            <p class="text-xs mt-1">Haz clic en "EJECUTAR MES" (desde mes 2 ver√°s eventos)</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="bg-yellow-900 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">4</div>
                        <div>
                            <strong class="text-yellow-900">Revisa resultados</strong>
                            <p class="text-xs mt-1">Analiza valor entregado, eficiencia y salud del equipo</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="bg-yellow-900 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">5</div>
                        <div>
                            <strong class="text-yellow-900">Contin√∫a al siguiente mes</strong>
                            <p class="text-xs mt-1">Ajusta estrategia y repite hasta completar 6 meses</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-amber-100 p-3 rounded-lg border border-amber-200">
                    <h4 class="font-bold text-amber-900 mb-2">üéØ Objetivo</h4>
                    <p class="text-sm text-amber-800">Entregar 410+ puntos de valor en 6 meses sin exceder $300,000</p>
                </div>
                <div class="bg-amber-100 p-3 rounded-lg border border-amber-200">
                    <h4 class="font-bold text-amber-900 mb-2">üí° Consejo clave</h4>
                    <p class="text-sm text-amber-800">WIP alto y horas extra reducen eficiencia - equilibra recursos</p>
                </div>
            </div>
        </div>

        <!-- Mes Actual -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-6 text-center border-2 border-amber-200">
            <div class="flex items-center justify-center space-x-2">
                <svg class="text-amber-600" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M8 2v4"/>
                    <path d="M16 2v4"/>
                    <rect width="18" height="18" x="3" y="4" rx="2"/>
                    <path d="M3 10h18"/>
                </svg>
                <span class="text-2xl font-bold text-amber-800" id="currentMonthDisplay">MES 1</span>
            </div>
        </div>

        <!-- Panel de Presupuesto -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6" id="budgetPanel">
            <div class="flex items-center mb-4">
                <svg class="text-green-600 mr-2" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="2" x2="12" y2="22"/>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
                <h2 class="text-xl font-semibold text-gray-900">Control de Presupuesto</h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-4" id="budgetBreakdown">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <div class="text-sm text-gray-600">Salarios Base</div>
                    <div class="text-xl font-bold text-blue-600" id="baseCost">$40,000</div>
                </div>
                <div class="bg-orange-50 p-4 rounded-lg">
                    <div class="text-sm text-gray-600">Horas Extra</div>
                    <div class="text-xl font-bold text-orange-600" id="overtimeCost">$0</div>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg">
                    <div class="text-sm text-gray-600">Contrataciones</div>
                    <div class="text-xl font-bold text-purple-600" id="hiringCost">$0</div>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="text-sm text-gray-600">Total Mensual</div>
                    <div class="text-xl font-bold text-green-600" id="totalCost">$40,000</div>
                    <div class="text-xs text-red-600 mt-1 hidden" id="exceedsLimit">Excede l√≠mite mensual</div>
                </div>
                <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-4 rounded-lg border border-amber-200">
                    <div class="text-sm text-gray-600">Presupuesto Total</div>
                    <div class="text-xl font-bold text-green-600" id="totalBudget">$40,000</div>
                    <div class="text-xs text-gray-500 mt-1">de $300,000</div>
                </div>
            </div>

            <div class="space-y-2">
                <!-- Barra de presupuesto mensual -->
                <div>
                    <div class="flex justify-between text-sm text-gray-600 mb-1">
                        <span>Presupuesto Mensual</span>
                        <span id="monthlyBudgetPercent">80%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="h-3 rounded-full transition-all duration-300 bg-green-500" id="monthlyBudgetBar" style="width: 80%"></div>
                    </div>
                </div>

                <!-- Barra de presupuesto total -->
                <div>
                    <div class="flex justify-between text-sm text-gray-600 mb-1">
                        <span>Presupuesto Total del Proyecto</span>
                        <span id="totalBudgetPercent">13%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="h-3 rounded-full transition-all duration-300 bg-green-500" id="totalBudgetBar" style="width: 13%"></div>
                    </div>
                </div>
            </div>

            <div class="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg hidden" id="budgetExceededWarning">
                <div class="flex items-center mb-2">
                    <svg class="text-red-600 mr-2" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                    <h4 class="font-bold text-red-800">¬°PRESUPUESTO TOTAL EXCEDIDO!</h4>
                </div>
                <p class="text-sm text-red-700">
                    Has excedido el presupuesto total del proyecto. Esto tendr√° consecuencias en tu evaluaci√≥n final.
                </p>
            </div>
        </div>

        <!-- Configuraci√≥n del Equipo -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-center mb-4">
                <svg class="text-gray-600 mr-2" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                    <circle cx="12" cy="12" r="3"/>
                </svg>
                <h2 class="text-xl font-semibold text-gray-900">Configuraci√≥n del Equipo</h2>
            </div>

            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                <h3 class="font-medium text-blue-900 mb-2">üí° CONFIGURACI√ìN ESTRAT√âGICA:</h3>
                <p class="text-sm text-blue-800">
                    <strong>Principios Lean:</strong> M√°s horas ‚â† m√°s valor. La sobrecarga genera burnout y reduce sostenibilidad. 
                    WIP alto causa context switching. Equipos dedicados son m√°s r√°pidos pero costosos. 
                    <strong>Encuentra el equilibrio √≥ptimo.</strong>
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="space-y-3">
                    <label class="block text-sm font-medium text-gray-700">
                        Tama√±o del Equipo: <span id="teamSizeLabel">5</span> personas
                    </label>
                    <input type="range" min="1" max="12" value="5" class="w-full" id="teamSizeSlider" oninput="updateTeamSize(this.value)">
                    <div class="text-xs text-gray-500">
                        M√°s personas = mayor capacidad pero mayor costo y coordinaci√≥n
                    </div>
                </div>

                <div class="space-y-3">
                    <label class="block text-sm font-medium text-gray-700">
                        Horas por semana: <span id="hoursLabel">40</span>h
                    </label>
                    <input type="range" min="30" max="60" value="40" class="w-full" id="hoursSlider" oninput="updateHours(this.value)">
                    <div class="text-xs text-gray-500" id="hoursWarning">
                        ‚úÖ Horario sostenible
                    </div>
                </div>

                <div class="space-y-3">
                    <label class="block text-sm font-medium text-gray-700">
                        L√≠mite de WIP: <span id="wipLabel">2</span> iniciativas
                    </label>
                    <input type="range" min="1" max="10" value="2" class="w-full" id="wipSlider" oninput="updateWip(this.value)">
                    <div class="text-xs text-gray-500" id="wipWarning">
                        ‚úÖ WIP balanceado con el tama√±o del equipo
                    </div>
                </div>
            </div>
        </div>

        <!-- Evento del Mes -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6 border-2 border-amber-400 hidden" id="eventPanel">
            <div class="flex items-center mb-4">
                <svg class="text-amber-600 mr-2" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <h2 class="text-xl font-semibold text-amber-900" id="eventTitle">EVENTO DEL MES</h2>
            </div>
            
            <div class="bg-gradient-to-r from-amber-100 to-orange-100 rounded-lg p-6 border border-amber-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <span class="text-4xl mr-4" id="eventIcon">üéØ</span>
                        <div>
                            <h3 class="text-xl font-bold text-amber-900" id="eventName">Evento</h3>
                            <p class="text-amber-800 mt-2" id="eventDescription">Descripci√≥n</p>
                        </div>
                    </div>
                    <div class="px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700" id="eventType">
                        ‚úÖ Positivo
                    </div>
                </div>
                
                <div class="bg-amber-50 rounded-lg p-4 border border-amber-200">
                    <h4 class="font-bold text-amber-900 mb-2">üí° Recomendaci√≥n Estrat√©gica:</h4>
                    <p class="text-sm text-amber-800" id="eventRecommendation">
                        Recomendaci√≥n estrat√©gica basada en el evento.
                    </p>
                </div>
            </div>
        </div>

        <!-- Estado de Salud del Equipo -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-center mb-4">
                <svg class="text-gray-600 mr-2" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                <h2 class="text-xl font-semibold text-gray-900">Estado de Salud del Equipo</h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="text-center p-4 bg-gray-50 rounded-lg border-2">
                    <div class="text-3xl font-bold text-green-600" id="burnoutLevel">0%</div>
                    <div class="text-sm text-gray-600 font-medium">Burnout</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg border-2">
                    <div class="text-3xl font-bold text-green-600" id="satisfactionLevel">100%</div>
                    <div class="text-sm text-gray-600 font-medium">Satisfacci√≥n</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg border-2">
                    <div class="text-3xl font-bold text-green-600" id="turnoverLevel">0%</div>
                    <div class="text-sm text-gray-600 font-medium">Rotaci√≥n</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg border-2">
                    <div class="text-3xl font-bold text-green-600" id="productivityLevel">100%</div>
                    <div class="text-sm text-gray-600 font-medium">Productividad</div>
                </div>
            </div>
        </div>

        <!-- Priorizaci√≥n de Iniciativas -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-center mb-4">
                <svg class="text-gray-600 mr-2" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <circle cx="12" cy="12" r="6"/>
                    <circle cx="12" cy="12" r="2"/>
                </svg>
                <h2 class="text-xl font-semibold text-gray-900">Priorizaci√≥n de Iniciativas</h2>
            </div>

            <div class="bg-green-50 p-4 rounded-lg mb-4">
                <h3 class="font-medium text-green-900 mb-3">üéØ GU√çA DE PRIORIZACI√ìN ESTRAT√âGICA</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-green-800">
                    <div class="bg-white p-3 rounded border border-green-200">
                        <h4 class="font-bold text-green-900 mb-2">üìä ALINEACI√ìN ESTRAT√âGICA</h4>
                        <p class="mb-2">Qu√© tan importante es la iniciativa para los objetivos organizacionales:</p>
                        <ul class="text-xs space-y-1">
                            <li><strong>‚Ä¢ Cr√≠tico:</strong> Impacto directo en objetivos corporativos</li>
                            <li><strong>‚Ä¢ Alto:</strong> Importante para competitividad</li>
                            <li><strong>‚Ä¢ Medio:</strong> Mejora operacional</li>
                            <li><strong>‚Ä¢ Bajo:</strong> Optimizaci√≥n menor</li>
                        </ul>
                    </div>
                    <div class="bg-white p-3 rounded border border-green-200">
                        <h4 class="font-bold text-green-900 mb-2">üîß COMPLEJIDAD T√âCNICA</h4>
                        <p class="mb-2">Nivel de dificultad t√©cnica y riesgo de desarrollo:</p>
                        <ul class="text-xs space-y-1">
                            <li><strong>‚Ä¢ Alta:</strong> Requiere 30% m√°s tiempo, mayor riesgo, arquitectura compleja</li>
                            <li><strong>‚Ä¢ Baja:</strong> Desarrollo est√°ndar, riesgo controlado, soluci√≥n conocida</li>
                        </ul>
                    </div>
                    <div class="bg-white p-3 rounded border border-green-200">
                        <h4 class="font-bold text-green-900 mb-2">üë• TIPO DE EQUIPO</h4>
                        <p class="mb-2">Modelo de asignaci√≥n de recursos:</p>
                        <ul class="text-xs space-y-1">
                            <li><strong>‚Ä¢ Dedicado:</strong> Equipo exclusivo, 100% disponible, mayor costo</li>
                            <li><strong>‚Ä¢ Compartido:</strong> Equipo multi-proyecto, 60% disponible, menor costo</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-3 p-3 bg-green-100 rounded border border-green-300">
                    <p class="text-sm text-green-900">
                        <strong>üí° Estrategia Lean:</strong> Prioriza por valor/esfuerzo considerando alineaci√≥n estrat√©gica, 
                        complejidad t√©cnica y disponibilidad de recursos. Iniciativas cr√≠ticas de baja complejidad suelen ser ideales.
                    </p>
                </div>
            </div>

            <div class="space-y-3" id="initiativesList">
                <!-- Las iniciativas se generar√°n din√°micamente -->
            </div>
        </div>

        <!-- Bot√≥n de Ejecuci√≥n -->
        <div class="text-center mb-6">
            <button onclick="executeMonth()" class="px-12 py-4 rounded-lg font-bold text-white text-xl bg-amber-500 hover:bg-amber-600 transition-colors shadow-lg" id="executeButton">
                <div class="flex items-center">
                    <svg class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="5,3 19,12 5,21 5,3"/>
                    </svg>
                    EJECUTAR MES 1
                </div>
            </button>
            
            <div class="mt-3 text-sm text-gray-600" id="executeHelp">
                Configura tu equipo, prioriza iniciativas y ejecuta tu primer mes
            </div>
            
            <div class="mt-2 p-3 bg-orange-50 border border-orange-200 rounded-lg hidden" id="budgetWarning">
                <div class="flex items-center justify-center">
                    <svg class="text-orange-600 mr-2" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                    <span class="text-sm text-orange-800" id="budgetWarningText">
                        ‚ö†Ô∏è Exceder√°s el presupuesto mensual
                    </span>
                </div>
            </div>
        </div>

        <!-- Resultados -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6 hidden" id="resultsPanel">
            <div class="flex items-center mb-4">
                <svg class="text-gray-600 mr-2" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 3v18h18"/>
                    <path d="M7 12l3-3 3 3 5-5"/>
                </svg>
                <h2 class="text-xl font-semibold text-gray-900" id="resultsTitle">RESULTADOS DEL MES</h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="text-center p-4 bg-green-50 rounded-lg border-2">
                    <div class="text-3xl font-bold text-green-600" id="valueDeliveredResult">0</div>
                    <div class="text-sm text-gray-600 font-medium">Valor Entregado</div>
                </div>
                <div class="text-center p-4 bg-blue-50 rounded-lg border-2">
                    <div class="text-3xl font-bold text-blue-600" id="projectsCompletedResult">0</div>
                    <div class="text-sm text-gray-600 font-medium">Completadas</div>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded-lg border-2">
                    <div class="text-3xl font-bold text-purple-600" id="efficiencyResult">0%</div>
                    <div class="text-sm text-gray-600 font-medium">Eficiencia</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg border-2">
                    <div class="text-3xl font-bold text-gray-600" id="budgetUsedResult">$0</div>
                    <div class="text-sm text-gray-600 font-medium">Presupuesto</div>
                </div>
            </div>

            <!-- Eventos y Advertencias -->
            <div class="border rounded-lg p-4 mb-6 bg-blue-50 border-blue-200" id="warningsPanel">
                <div class="flex items-center mb-3">
                    <svg class="text-blue-600 mr-2" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                    <h3 class="font-bold text-blue-800" id="warningsTitle">ADVERTENCIAS DEL MES</h3>
                </div>
                <ul class="text-sm space-y-2" id="warningsList">
                    <li class="flex items-start text-green-700">
                        <span class="mr-2">‚Ä¢</span>
                        <span>üìÖ Mes 1 - Sin eventos. Configuraci√≥n inicial completada exitosamente.</span>
                    </li>
                </ul>
            </div>

            <div class="flex justify-center space-x-4">
                <div class="flex flex-col items-center">
                    <button onclick="nextMonth()" class="px-8 py-3 rounded-lg transition-colors font-medium text-lg bg-amber-500 text-white hover:bg-amber-600" id="nextMonthButton">
                        SIGUIENTE MES ‚Üí
                    </button>
                    <div class="mt-2 text-xs text-amber-600 text-center" id="nextMonthHelp">
                        üí° Los eventos aleatorios empiezan desde el mes 2
                    </div>
                </div>
                <button onclick="resetSimulation()" class="px-8 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium">
                    NUEVA SIMULACI√ìN
                </button>
            </div>
        </div>

        <!-- Historial -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6 hidden" id="historyPanel">
            <div class="flex items-center mb-4">
                <svg class="text-gray-600 mr-2" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12,6 12,12 16,14"/>
                </svg>
                <h2 class="text-xl font-semibold text-gray-900">HISTORIAL</h2>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left font-medium">Mes</th>
                            <th class="px-4 py-3 text-left font-medium">Evento</th>
                            <th class="px-4 py-3 text-left font-medium">Valor</th>
                            <th class="px-4 py-3 text-left font-medium">Completadas</th>
                            <th class="px-4 py-3 text-left font-medium">Eficiencia</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <!-- Historial se generar√° din√°micamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Resumen Profesional -->
        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden" id="professionalSummaryModal">
            <div class="bg-white rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-white border-b border-gray-200 p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="text-3xl font-black text-amber-500 mr-4">AGILITY CHANGES</div>
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900">Resumen Final de Desempe√±o</h2>
                                <p class="text-gray-600">An√°lisis Completo de tu Gesti√≥n Lean Portfolio</p>
                            </div>
                        </div>
                        <button onclick="closeProfessionalSummary()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">
                            ‚úï
                        </button>
                    </div>
                </div>

                <div class="p-6" id="professionalSummaryContent">
                    <!-- Contenido se generar√° din√°micamente -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales del estado
        let currentMonth = 1;
        let isExecuting = false;
        let showResults = false;
        let showInstructions = true;
        let showProfessionalSummary = false;
        let monthExecuted = false;
        
        // Presupuesto y costos
        const monthlyBudget = 50000;
        const baseSalaryPerPerson = 8000;
        const overtimeCostPerHour = 50;
        const hiringCost = 5000;
        
        // Configuraci√≥n del equipo
        let teamSize = 5;
        let hoursPerPersonPerWeek = 40;
        let wipLimit = 2;
        let previousTeamSize = 5;
        
        // Objetivos
        const targetValue = 410;
        const targetMonths = 6;
        
        // Estado del equipo
        let teamHealth = {
            burnoutLevel: 0,
            satisfaction: 100,
            turnover: 0,
            productivity: 100
        };

        // Eventos y variables
        let currentEvent = null;
        let upcomingEvent = null;
        let lastEventType = null;
        let monthlyVariability = 1;
        let totalBudgetUsed = 0;

        // Iniciativas
        let initiatives = [
            {
                id: 1,
                name: 'Plataforma E-commerce',
                businessValue: 120,
                effortWeeks: 14,
                originalEffort: 14,
                strategicAlignment: 'Cr√≠tico',
                complexity: 'Alta',
                teamType: 'dedicated',
                status: 'backlog',
                progress: 0,
                priority: 1,
                blockedWeeks: 0,
                hasIssues: false
            },
            {
                id: 2,
                name: 'App Mobile',
                businessValue: 90,
                effortWeeks: 10,
                originalEffort: 10,
                strategicAlignment: 'Alto',
                complexity: 'Baja',
                teamType: 'shared',
                status: 'backlog',
                progress: 0,
                priority: 2,
                blockedWeeks: 0,
                hasIssues: false
            },
            {
                id: 3,
                name: 'Sistema CRM',
                businessValue: 75,
                effortWeeks: 12,
                originalEffort: 12,
                strategicAlignment: 'Medio',
                complexity: 'Alta',
                teamType: 'shared',
                status: 'backlog',
                progress: 0,
                priority: 3,
                blockedWeeks: 0,
                hasIssues: false
            },
            {
                id: 4,
                name: 'Automatizaci√≥n QA',
                businessValue: 60,
                effortWeeks: 8,
                originalEffort: 8,
                strategicAlignment: 'Medio',
                complexity: 'Baja',
                teamType: 'dedicated',
                status: 'backlog',
                progress: 0,
                priority: 4,
                blockedWeeks: 0,
                hasIssues: false
            },
            {
                id: 5,
                name: 'Refactoring Backend',
                businessValue: 45,
                effortWeeks: 6,
                originalEffort: 6,
                strategicAlignment: 'Bajo',
                complexity: 'Baja',
                teamType: 'shared',
                status: 'backlog',
                progress: 0,
                priority: 5,
                blockedWeeks: 0,
                hasIssues: false
            },
            {
                id: 6,
                name: 'Analytics Dashboard',
                businessValue: 65,
                effortWeeks: 9,
                originalEffort: 9,
                strategicAlignment: 'Alto',
                complexity: 'Alta',
                teamType: 'dedicated',
                status: 'backlog',
                progress: 0,
                priority: 6,
                blockedWeeks: 0,
                hasIssues: false
            }
        ];

        // M√©tricas
        let monthlyResults = {
            valueDelivered: 0,
            projectsCompleted: 0,
            teamEfficiency: 0,
            budgetUsed: 0,
            warnings: [],
            event: null
        };

        let monthlyHistory = [];
        let totalValueDelivered = 0;

        // Eventos posibles
        const possibleEvents = [
            {
                id: 'requirement_change',
                name: 'Cambio de Requerimientos',
                description: 'Los stakeholders cambiaron los requerimientos. Una iniciativa requiere 40% m√°s esfuerzo.',
                icon: 'üîÑ',
                effect: 'effort_increase',
                severity: 'high',
                type: 'negative'
            },
            {
                id: 'critical_bug',
                name: 'Bug Cr√≠tico en Producci√≥n',
                description: 'Se descubri√≥ un bug cr√≠tico en producci√≥n. Productividad reducida 30% este mes.',
                icon: 'üêõ',
                effect: 'productivity_reduce',
                severity: 'high',
                type: 'negative'
            },
            {
                id: 'team_member_sick',
                name: 'Miembro del Equipo Enfermo',
                description: 'Un miembro clave del equipo est√° enfermo. Capacidad reducida 20% este mes.',
                icon: 'ü§í',
                effect: 'capacity_reduce',
                severity: 'medium',
                type: 'negative'
            },
            {
                id: 'infrastructure_failure',
                name: 'Falla de Infraestructura',
                description: 'Problemas t√©cnicos en la infraestructura. Productividad reducida 25% este mes.',
                icon: '‚ö†Ô∏è',
                effect: 'productivity_reduce',
                severity: 'medium',
                type: 'negative'
            },
            {
                id: 'dependency_blocked',
                name: 'Dependencia Bloqueada',
                description: 'Una dependencia externa est√° bloqueada. Una iniciativa se retrasa significativamente.',
                icon: 'üöß',
                effect: 'block_initiative',
                severity: 'medium',
                type: 'negative'
            },
            {
                id: 'good_month',
                name: 'Mes Excepcionalmente Productivo',
                description: 'Todo sale perfectamente. Productividad aumentada 25% este mes.',
                icon: 'üöÄ',
                effect: 'productivity_boost',
                severity: 'positive',
                type: 'positive'
            },
            {
                id: 'new_tool',
                name: 'Herramienta de Automatizaci√≥n',
                description: 'Nueva herramienta mejora la eficiencia. Productividad aumentada 20% este mes.',
                icon: 'üîß',
                effect: 'productivity_boost',
                severity: 'positive',
                type: 'positive'
            },
            {
                id: 'team_motivation',
                name: 'Equipo S√∫per Motivado',
                description: 'El equipo est√° muy motivado y enfocado. Eficiencia aumentada 30% este mes.',
                icon: 'üí™',
                effect: 'motivation_boost',
                severity: 'positive',
                type: 'positive'
            },
            {
                id: 'market_opportunity',
                name: 'Oportunidad de Mercado Urgente',
                description: 'Nueva oportunidad cr√≠tica del mercado. Se agrega una iniciativa de alto valor.',
                icon: 'üí°',
                effect: 'new_initiative',
                severity: 'neutral',
                type: 'neutral'
            },
            {
                id: 'client_feedback',
                name: 'Feedback Positivo del Cliente',
                description: 'Excelente feedback del cliente reduce complejidad. Una iniciativa se simplifica.',
                icon: 'üëè',
                effect: 'simplify_initiative',
                severity: 'positive',
                type: 'positive'
            }
        ];

        // Funciones de utilidad
        function hideInstructions() {
            document.getElementById('instructionsPanel').classList.add('hidden');
            showInstructions = false;
        }

        function updateTeamSize(value) {
            teamSize = parseInt(value);
            document.getElementById('teamSizeLabel').textContent = teamSize;
            updateBudgetDisplay();
            updateHoursWarning();
            updateWipWarning();
        }

        function updateHours(value) {
            hoursPerPersonPerWeek = parseInt(value);
            document.getElementById('hoursLabel').textContent = hoursPerPersonPerWeek;
            updateBudgetDisplay();
            updateHoursWarning();
        }

        function updateWip(value) {
            wipLimit = parseInt(value);
            document.getElementById('wipLabel').textContent = wipLimit;
            updateWipWarning();
        }

        function updateHoursWarning() {
            const warning = document.getElementById('hoursWarning');
            if (hoursPerPersonPerWeek > 50) {
                warning.textContent = 'üö® Riesgo cr√≠tico de burnout';
                warning.className = 'text-xs text-red-600';
            } else if (hoursPerPersonPerWeek > 40) {
                warning.textContent = '‚ö†Ô∏è Riesgo de burnout y rotaci√≥n';
                warning.className = 'text-xs text-orange-600';
            } else {
                warning.textContent = '‚úÖ Horario sostenible';
                warning.className = 'text-xs text-green-600';
            }
        }

        function updateWipWarning() {
            const warning = document.getElementById('wipWarning');
            if (wipLimit > teamSize) {
                warning.textContent = '‚ö†Ô∏è WIP alto puede reducir eficiencia';
                warning.className = 'text-xs text-orange-600';
            } else {
                warning.textContent = '‚úÖ WIP balanceado con el tama√±o del equipo';
                warning.className = 'text-xs text-green-600';
            }
        }

        function calculateCosts() {
            const baseCost = teamSize * baseSalaryPerPerson;
            const overtimeHours = Math.max(0, hoursPerPersonPerWeek - 40);
            const overtimeCost = teamSize * overtimeHours * 4 * overtimeCostPerHour;
            const hiringCostThisMonth = teamSize > previousTeamSize ? (teamSize - previousTeamSize) * hiringCost : 0;
            const totalCost = baseCost + overtimeCost + hiringCostThisMonth;
            
            return {
                baseCost,
                overtimeCost,
                hiringCost: hiringCostThisMonth,
                totalCost
            };
        }

        function updateBudgetDisplay() {
            const costs = calculateCosts();
            
            document.getElementById('baseCost').textContent = `$${costs.baseCost.toLocaleString()}`;
            document.getElementById('overtimeCost').textContent = `$${costs.overtimeCost.toLocaleString()}`;
            document.getElementById('hiringCost').textContent = `$${costs.hiringCost.toLocaleString()}`;
            
            const totalCostElement = document.getElementById('totalCost');
            totalCostElement.textContent = `$${costs.totalCost.toLocaleString()}`;
            
            if (costs.totalCost > monthlyBudget) {
                totalCostElement.className = 'text-xl font-bold text-red-600';
                document.getElementById('exceedsLimit').classList.remove('hidden');
            } else {
                totalCostElement.className = 'text-xl font-bold text-green-600';
                document.getElementById('exceedsLimit').classList.add('hidden');
            }
            
            const totalBudgetElement = document.getElementById('totalBudget');
            const projectedTotal = totalBudgetUsed + costs.totalCost;
            totalBudgetElement.textContent = `$${projectedTotal.toLocaleString()}`;
            
            if (projectedTotal > monthlyBudget * targetMonths) {
                totalBudgetElement.className = 'text-xl font-bold text-red-600';
                document.getElementById('budgetExceededWarning').classList.remove('hidden');
            } else {
                totalBudgetElement.className = 'text-xl font-bold text-green-600';
                document.getElementById('budgetExceededWarning').classList.add('hidden');
            }
            
            // Actualizar barras de progreso
            const monthlyPercent = Math.round((costs.totalCost / monthlyBudget) * 100);
            const totalPercent = Math.round((projectedTotal / (monthlyBudget * targetMonths)) * 100);
            
            document.getElementById('monthlyBudgetPercent').textContent = `${monthlyPercent}%`;
            document.getElementById('totalBudgetPercent').textContent = `${totalPercent}%`;
            
            const monthlyBar = document.getElementById('monthlyBudgetBar');
            const totalBar = document.getElementById('totalBudgetBar');
            
            monthlyBar.style.width = `${Math.min(100, monthlyPercent)}%`;
            totalBar.style.width = `${Math.min(100, totalPercent)}%`;
            
            // Colores de las barras
            if (costs.totalCost > monthlyBudget) {
                monthlyBar.className = 'h-3 rounded-full transition-all duration-300 bg-red-500';
            } else if (costs.totalCost > monthlyBudget * 0.8) {
                monthlyBar.className = 'h-3 rounded-full transition-all duration-300 bg-amber-500';
            } else {
                monthlyBar.className = 'h-3 rounded-full transition-all duration-300 bg-green-500';
            }
            
            if (projectedTotal > monthlyBudget * targetMonths) {
                totalBar.className = 'h-3 rounded-full transition-all duration-300 bg-red-500';
            } else if (projectedTotal > monthlyBudget * targetMonths * 0.8) {
                totalBar.className = 'h-3 rounded-full transition-all duration-300 bg-amber-500';
            } else {
                totalBar.className = 'h-3 rounded-full transition-all duration-300 bg-green-500';
            }
            
            // Actualizar advertencia de presupuesto
            const budgetWarning = document.getElementById('budgetWarning');
            const warningText = document.getElementById('budgetWarningText');
            if (costs.totalCost > monthlyBudget && !monthExecuted) {
                budgetWarning.classList.remove('hidden');
                warningText.textContent = `‚ö†Ô∏è Exceder√°s el presupuesto mensual (+$${(costs.totalCost - monthlyBudget).toLocaleString()})`;
            } else {
                budgetWarning.classList.add('hidden');
            }
        }

        function updateObjectiveStatus() {
            const progressPercentage = Math.round((totalValueDelivered / targetValue) * 100);
            const statusElement = document.getElementById('objectiveStatus');
            const progressElement = document.getElementById('progressInfo');
            
            if (totalValueDelivered >= targetValue) {
                statusElement.textContent = 'üéâ ¬°OBJETIVO ALCANZADO!';
                statusElement.className = 'text-lg font-medium text-green-600';
            } else if (currentMonth > targetMonths) {
                statusElement.textContent = '‚ùå OBJETIVO NO ALCANZADO';
                statusElement.className = 'text-lg font-medium text-red-600';
            } else {
                statusElement.textContent = `üéØ ${progressPercentage}% del objetivo completado`;
                statusElement.className = 'text-lg font-medium text-amber-600';
            }
            
            progressElement.textContent = `Progreso: ${totalValueDelivered}/${targetValue} | Mes: ${currentMonth}/${targetMonths}`;
        }

        function updateTeamHealthDisplay() {
            const getHealthColor = (value, reverse = false) => {
                if (reverse) {
                    if (value >= 70) return 'text-red-600';
                    if (value >= 40) return 'text-yellow-600';
                    return 'text-green-600';
                } else {
                    if (value >= 80) return 'text-green-600';
                    if (value >= 60) return 'text-yellow-600';
                    return 'text-red-600';
                }
            };
            
            document.getElementById('burnoutLevel').textContent = `${teamHealth.burnoutLevel}%`;
            document.getElementById('burnoutLevel').className = `text-3xl font-bold ${getHealthColor(teamHealth.burnoutLevel, true)}`;
            
            document.getElementById('satisfactionLevel').textContent = `${teamHealth.satisfaction}%`;
            document.getElementById('satisfactionLevel').className = `text-3xl font-bold ${getHealthColor(teamHealth.satisfaction)}`;
            
            document.getElementById('turnoverLevel').textContent = `${teamHealth.turnover}%`;
            document.getElementById('turnoverLevel').className = `text-3xl font-bold ${getHealthColor(teamHealth.turnover, true)}`;
            
            document.getElementById('productivityLevel').textContent = `${teamHealth.productivity}%`;
            document.getElementById('productivityLevel').className = `text-3xl font-bold ${getHealthColor(teamHealth.productivity)}`;
        }

        function generateUpcomingEvent() {
            let availableEvents = possibleEvents;
            
            if (lastEventType) {
                availableEvents = possibleEvents.filter(event => event.effect !== lastEventType);
            }
            
            if (availableEvents.length === 0) {
                availableEvents = possibleEvents;
            }
            
            const event = availableEvents[Math.floor(Math.random() * availableEvents.length)];
            upcomingEvent = event;
            lastEventType = event.effect;
            
            showEventPanel(event);
        }

        function showEventPanel(event) {
            const eventPanel = document.getElementById('eventPanel');
            const eventTitle = document.getElementById('eventTitle');
            const eventIcon = document.getElementById('eventIcon');
            const eventName = document.getElementById('eventName');
            const eventDescription = document.getElementById('eventDescription');
            const eventType = document.getElementById('eventType');
            const eventRecommendation = document.getElementById('eventRecommendation');
            
            eventPanel.classList.remove('hidden');
            eventTitle.textContent = `EVENTO DEL MES ${currentMonth}`;
            eventIcon.textContent = event.icon;
            eventName.textContent = event.name;
            eventDescription.textContent = event.description;
            
            // Tipo de evento
            if (event.type === 'positive') {
                eventType.textContent = '‚úÖ Positivo';
                eventType.className = 'px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700';
            } else if (event.type === 'negative') {
                eventType.textContent = '‚ùå Negativo';
                eventType.className = 'px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700';
            } else {
                eventType.textContent = '‚ö° Neutro';
                eventType.className = 'px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700';
            }
            
            // Recomendaci√≥n
            const recommendations = {
                'effort_increase': 'Considera reducir el WIP y enfocarte en iniciativas cr√≠ticas. Equipos dedicados pueden ser m√°s resilientes.',
                'productivity_reduce': 'Reduce las horas extra y el WIP para minimizar el impacto. Prioriza iniciativas de menor complejidad.',
                'capacity_reduce': 'Ajusta el WIP hacia abajo y considera posponer iniciativas menos cr√≠ticas.',
                'block_initiative': 'Prep√°rate para que una iniciativa se retrase. Considera tener iniciativas alternativas listas.',
                'new_initiative': 'Se agregar√° una nueva iniciativa cr√≠tica. Prep√°rate para ajustar prioridades y recursos.',
                'productivity_boost': 'Aprovecha este mes para avanzar en iniciativas complejas o de alto valor. Considera aumentar el WIP temporalmente.',
                'motivation_boost': 'Excelente momento para impulsar iniciativas desafiantes. El equipo est√° en su mejor momento.',
                'simplify_initiative': 'Una iniciativa se simplificar√°. Considera adelantar trabajo en iniciativas complejas.'
            };
            
            eventRecommendation.textContent = recommendations[event.effect] || 'Recomendaci√≥n estrat√©gica basada en el evento.';
        }

        function hideEventPanel() {
            document.getElementById('eventPanel').classList.add('hidden');
        }

        function movePriority(id, direction) {
            const targetIndex = initiatives.findIndex(i => i.id === id);
            const targetInitiative = initiatives[targetIndex];
            
            if (targetInitiative.status !== 'backlog') {
                return;
            }
            
            const newIndex = direction === 'up' ? targetIndex - 1 : targetIndex + 1;
            
            if (newIndex >= 0 && newIndex < initiatives.length) {
                const destinationInitiative = initiatives[newIndex];
                
                if (destinationInitiative.status === 'backlog') {
                    [initiatives[targetIndex], initiatives[newIndex]] = [initiatives[newIndex], initiatives[targetIndex]];
                    
                    initiatives.forEach((item, idx) => {
                        item.priority = idx + 1;
                    });
                    
                    renderInitiatives();
                }
            }
        }

        function changeInitiativeTeamType(id, newTeamType) {
            const initiative = initiatives.find(i => i.id === id);
            
            if (initiative && initiative.status === 'backlog') {
                initiative.teamType = newTeamType;
                renderInitiatives();
            }
        }

        function getStatusColor(status) {
            switch (status) {
                case 'backlog': return 'bg-gray-100 border-gray-300';
                case 'in-progress': return 'bg-blue-100 border-blue-300';
                case 'done': return 'bg-green-100 border-green-300';
                default: return 'bg-gray-100';
            }
        }

        function getAlignmentColor(alignment) {
            switch (alignment) {
                case 'Cr√≠tico': return 'text-red-700 bg-red-100';
                case 'Alto': return 'text-orange-700 bg-orange-100';
                case 'Medio': return 'text-yellow-700 bg-yellow-100';
                case 'Bajo': return 'text-green-700 bg-green-100';
                default: return 'text-gray-700 bg-gray-100';
            }
        }

        function getComplexityColor(complexity) {
            switch (complexity) {
                case 'Alta': return 'text-red-700 bg-red-100';
                case 'Baja': return 'text-green-700 bg-green-100';
                default: return 'text-gray-700 bg-gray-100';
            }
        }

        function getTeamTypeColor(teamType) {
            switch (teamType) {
                case 'dedicated': return 'text-blue-700 bg-blue-100';
                case 'shared': return 'text-orange-700 bg-orange-100';
                default: return 'text-gray-700 bg-gray-100';
            }
        }

        function getTeamTypeLabel(teamType) {
            return teamType === 'dedicated' ? 'Dedicado' : 'Compartido';
        }

        function getAlignmentExplanation(alignment) {
            switch (alignment) {
                case 'Cr√≠tico': return 'Impacto directo en objetivos corporativos - M√°xima prioridad';
                case 'Alto': return 'Importante para competitividad - Alta prioridad';
                case 'Medio': return 'Mejora operacional - Prioridad media';
                case 'Bajo': return 'Optimizaci√≥n menor - Baja prioridad';
                default: return 'Nivel de importancia no definido';
            }
        }

        function getComplexityExplanation(complexity) {
            switch (complexity) {
                case 'Alta': return 'Requiere 30% m√°s tiempo, mayor riesgo t√©cnico, arquitectura compleja';
                case 'Baja': return 'Desarrollo est√°ndar, riesgo controlado, soluci√≥n conocida';
                default: return 'Nivel de complejidad no definido';
            }
        }

        function getTeamTypeExplanation(teamType) {
            switch (teamType) {
                case 'dedicated': return 'Equipo exclusivo - 100% disponible, mayor velocidad, mayor costo';
                case 'shared': return 'Equipo multi-proyecto - 60% disponible, menor velocidad, menor costo';
                default: return 'Tipo de equipo no definido';
            }
        }

        function renderInitiatives() {
            const container = document.getElementById('initiativesList');
            container.innerHTML = '';
            
            initiatives.forEach((initiative, index) => {
                const div = document.createElement('div');
                div.className = `p-4 rounded-lg border-2 ${getStatusColor(initiative.status)}`;
                
                div.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="flex flex-col items-center">
                                <button onclick="movePriority(${initiative.id}, 'up')" 
                                        ${index === 0 || isExecuting || initiative.status !== 'backlog' ? 'disabled' : ''}
                                        class="text-gray-500 hover:text-gray-700 disabled:opacity-50 p-1 text-lg">
                                    ‚Üë
                                </button>
                                <span class="font-bold text-xl bg-white rounded-full w-10 h-10 flex items-center justify-center border-2">
                                    ${initiative.priority}
                                </span>
                                <button onclick="movePriority(${initiative.id}, 'down')" 
                                        ${index === initiatives.length - 1 || isExecuting || initiative.status !== 'backlog' ? 'disabled' : ''}
                                        class="text-gray-500 hover:text-gray-700 disabled:opacity-50 p-1 text-lg">
                                    ‚Üì
                                </button>
                            </div>
                            
                            <div class="flex-1">
                                <div class="flex items-center space-x-2 mb-2">
                                    <h3 class="font-medium text-lg">${initiative.name}</h3>
                                    <span class="px-2 py-1 rounded text-xs font-medium ${getAlignmentColor(initiative.strategicAlignment)}"
                                          title="${getAlignmentExplanation(initiative.strategicAlignment)}">
                                        Alineaci√≥n: ${initiative.strategicAlignment}
                                    </span>
                                    <span class="px-2 py-1 rounded text-xs font-medium ${getComplexityColor(initiative.complexity)}"
                                          title="${getComplexityExplanation(initiative.complexity)}">
                                        Complejidad: ${initiative.complexity}
                                    </span>
                                    ${initiative.hasIssues ? '<span class="px-2 py-1 rounded text-xs bg-red-100 text-red-700 font-medium">üêõ Afectada</span>' : ''}
                                    ${initiative.blockedWeeks > 0 ? `<span class="px-2 py-1 rounded text-xs bg-orange-100 text-orange-700 font-medium">üöß Bloqueada (${initiative.blockedWeeks} sem)</span>` : ''}
                                    <span class="px-2 py-1 rounded text-xs font-medium ${
                                        initiative.status === 'backlog' ? 'bg-gray-100 text-gray-700' : 
                                        initiative.status === 'in-progress' ? 'bg-blue-100 text-blue-700' : 
                                        'bg-green-100 text-green-700'
                                    }">
                                        ${initiative.status === 'backlog' ? 'En espera' : 
                                          initiative.status === 'in-progress' ? 'En progreso' : 'Completada'}
                                    </span>
                                </div>
                                
                                <div class="mb-3 p-3 bg-gray-50 rounded-lg">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-xs">
                                        <div class="p-2 bg-white rounded border border-gray-200">
                                            <strong class="text-gray-800 flex items-center">
                                                üéØ Alineaci√≥n Estrat√©gica: 
                                                <span class="ml-2 px-2 py-1 rounded text-xs ${getAlignmentColor(initiative.strategicAlignment)}">
                                                    ${initiative.strategicAlignment}
                                                </span>
                                            </strong>
                                            <div class="text-gray-600 mt-1">
                                                <strong>Significado:</strong> ${getAlignmentExplanation(initiative.strategicAlignment)}
                                            </div>
                                        </div>
                                        <div class="p-2 bg-white rounded border border-gray-200">
                                            <strong class="text-gray-800 flex items-center">
                                                üîß Complejidad T√©cnica: 
                                                <span class="ml-2 px-2 py-1 rounded text-xs ${getComplexityColor(initiative.complexity)}">
                                                    ${initiative.complexity}
                                                </span>
                                            </strong>
                                            <div class="text-gray-600 mt-1">
                                                <strong>Impacto:</strong> ${getComplexityExplanation(initiative.complexity)}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                                    <div>
                                        <span class="text-gray-600">Valor:</span>
                                        <span class="font-bold ml-2 text-green-600 text-lg">${initiative.businessValue}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">Esfuerzo:</span>
                                        <span class="font-bold ml-2 text-blue-600">
                                            ${initiative.effortWeeks} semanas
                                            ${initiative.complexity === 'Alta' ? '<span class="text-red-600 text-xs ml-1">(+30%)</span>' : ''}
                                        </span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">Progreso:</span>
                                        <span class="font-bold ml-2 text-lg">${Math.round(initiative.progress)}%</span>
                                    </div>
                                    <div>
                                        ${initiative.status === 'backlog' ? 
                                            `<div class="flex items-center space-x-2">
                                                <span class="text-gray-600 text-xs">Equipo:</span>
                                                <select onchange="changeInitiativeTeamType(${initiative.id}, this.value)"
                                                        ${isExecuting ? 'disabled' : ''}
                                                        class="text-xs border rounded px-2 py-1"
                                                        title="${getTeamTypeExplanation(initiative.teamType)}">
                                                    <option value="dedicated" ${initiative.teamType === 'dedicated' ? 'selected' : ''}>Dedicado</option>
                                                    <option value="shared" ${initiative.teamType === 'shared' ? 'selected' : ''}>Compartido</option>
                                                </select>
                                            </div>` :
                                            `<span class="px-2 py-1 rounded text-xs font-medium ${getTeamTypeColor(initiative.teamType)}"
                                                   title="${getTeamTypeExplanation(initiative.teamType)}">
                                                ${getTeamTypeLabel(initiative.teamType)}
                                            </span>`
                                        }
                                    </div>
                                </div>

                                <div class="mt-2 p-2 bg-blue-50 rounded text-xs">
                                    <div class="flex items-center">
                                        <strong class="text-blue-800">üë• Tipo de Equipo:</strong>
                                        <span class="ml-2 px-2 py-1 rounded text-xs ${getTeamTypeColor(initiative.teamType)}">
                                            ${getTeamTypeLabel(initiative.teamType)}
                                        </span>
                                    </div>
                                    <div class="text-blue-700 mt-1">
                                        <strong>Implicaciones:</strong> ${getTeamTypeExplanation(initiative.teamType)}
                                    </div>
                                </div>
                                
                                ${initiative.status === 'in-progress' ? 
                                    `<div class="mt-3 w-full bg-gray-200 rounded-full h-3">
                                        <div class="bg-blue-600 h-3 rounded-full transition-all duration-300"
                                             style="width: ${initiative.progress}%"></div>
                                    </div>` : ''
                                }
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        // Funciones principales de simulaci√≥n
        function applyEventEffect(event) {
            if (!event) return;

            switch (event.effect) {
                case 'effort_increase':
                    const inProgressForIncrease = initiatives.filter(i => i.status === 'in-progress');
                    if (inProgressForIncrease.length > 0) {
                        const targetInitiative = inProgressForIncrease[Math.floor(Math.random() * inProgressForIncrease.length)];
                        targetInitiative.effortWeeks = Math.round(targetInitiative.effortWeeks * 1.4);
                        targetInitiative.hasIssues = true;
                    }
                    break;
                    
                case 'productivity_reduce':
                    monthlyVariability = 0.7;
                    break;
                    
                case 'capacity_reduce':
                    monthlyVariability = 0.8;
                    break;
                    
                case 'block_initiative':
                    const inProgressForBlock = initiatives.filter(i => i.status === 'in-progress');
                    if (inProgressForBlock.length > 0) {
                        const targetInitiative = inProgressForBlock[Math.floor(Math.random() * inProgressForBlock.length)];
                        targetInitiative.blockedWeeks = 2;
                        targetInitiative.hasIssues = true;
                    }
                    break;
                    
                case 'new_initiative':
                    const newInitiative = {
                        id: Date.now(),
                        name: 'Iniciativa Cr√≠tica Urgente',
                        businessValue: 140,
                        effortWeeks: 8,
                        originalEffort: 8,
                        strategicAlignment: 'Cr√≠tico',
                        complexity: 'Alta',
                        teamType: 'dedicated',
                        status: 'backlog',
                        progress: 0,
                        priority: 1,
                        blockedWeeks: 0,
                        hasIssues: false
                    };
                    initiatives.unshift(newInitiative);
                    initiatives.forEach((item, idx) => {
                        item.priority = idx + 1;
                    });
                    break;
                    
                case 'productivity_boost':
                    monthlyVariability = 1.25;
                    break;
                    
                case 'motivation_boost':
                    monthlyVariability = 1.3;
                    break;
                    
                case 'simplify_initiative':
                    const inProgressForSimplify = initiatives.filter(i => i.status === 'in-progress');
                    if (inProgressForSimplify.length > 0) {
                        const targetInitiative = inProgressForSimplify[Math.floor(Math.random() * inProgressForSimplify.length)];
                        targetInitiative.effortWeeks = Math.round(targetInitiative.effortWeeks * 0.8);
                        targetInitiative.complexity = 'Baja';
                    }
                    break;
                    
                default:
                    break;
            }
        }

        function calculateTeamImpact() {
            let newBurnout = teamHealth.burnoutLevel;
            let newSatisfaction = teamHealth.satisfaction;
            let newProductivity = teamHealth.productivity;
            let newTurnover = teamHealth.turnover;

            // IMPACTO DE HORAS EXTRA
            if (hoursPerPersonPerWeek > 45) {
                const overloadFactor = (hoursPerPersonPerWeek - 40) / 40;
                newBurnout = Math.min(100, newBurnout + overloadFactor * 35);
                newSatisfaction = Math.max(0, newSatisfaction - overloadFactor * 30);
                newProductivity = Math.max(50, newProductivity - overloadFactor * 25);
            } else if (hoursPerPersonPerWeek > 40) {
                const overloadFactor = (hoursPerPersonPerWeek - 40) / 40;
                newBurnout = Math.min(100, newBurnout + overloadFactor * 20);
                newSatisfaction = Math.max(0, newSatisfaction - overloadFactor * 15);
                newProductivity = Math.max(70, newProductivity - overloadFactor * 10);
            }

            // CONSECUENCIAS DEL WIP ALTO
            if (wipLimit > teamSize * 1.5) {
                const thrashingFactor = (wipLimit - teamSize) / teamSize;
                newProductivity = Math.max(25, newProductivity - thrashingFactor * 50);
                newBurnout = Math.min(100, newBurnout + thrashingFactor * 40);
                newSatisfaction = Math.max(0, newSatisfaction - thrashingFactor * 35);
            } else if (wipLimit > teamSize) {
                const thrashingFactor = (wipLimit - teamSize) / teamSize;
                newProductivity = Math.max(40, newProductivity - thrashingFactor * 35);
                newBurnout = Math.min(100, newBurnout + thrashingFactor * 25);
                newSatisfaction = Math.max(0, newSatisfaction - thrashingFactor * 20);
            }

            // BURNOUT CAUSA ROTACI√ìN
            if (newBurnout > 80) {
                newTurnover = Math.min(100, newTurnover + (newBurnout - 80) * 3);
            } else if (newBurnout > 60) {
                newTurnover = Math.min(100, newTurnover + (newBurnout - 60) * 1.5);
            } else if (newBurnout > 40) {
                newTurnover = Math.min(100, newTurnover + (newBurnout - 40) * 0.5);
            }

            // SATISFACCI√ìN BAJA TAMBI√âN CAUSA ROTACI√ìN
            if (newSatisfaction < 30) {
                newTurnover = Math.min(100, newTurnover + (30 - newSatisfaction) * 1.2);
            } else if (newSatisfaction < 50) {
                newTurnover = Math.min(100, newTurnover + (50 - newSatisfaction) * 0.8);
            }

            // RECUPERACI√ìN GRADUAL
            if (hoursPerPersonPerWeek <= 40 && wipLimit <= teamSize && newBurnout < 60) {
                newBurnout = Math.max(0, newBurnout - 8);
                newSatisfaction = Math.min(100, newSatisfaction + 5);
                newProductivity = Math.min(100, newProductivity + 4);
                newTurnover = Math.max(0, newTurnover - 3);
            }

            teamHealth = {
                burnoutLevel: Math.round(newBurnout),
                satisfaction: Math.round(newSatisfaction),
                turnover: Math.round(newTurnover),
                productivity: Math.round(newProductivity)
            };
        }

        function calculateMultiProjectPenalty(activeProjects) {
            if (activeProjects <= 1) return 1.0;
            
            const basePenalty = activeProjects === 2 ? 0.85 : 
                               activeProjects === 3 ? 0.70 : 0.60;
            
            const randomVariation = 0.9 + (Math.random() * 0.2);
            return Math.max(0.4, basePenalty * randomVariation);
        }

        function getInitiativeTeamFactor(teamType) {
            switch (teamType) {
                case 'dedicated':
                    return { availability: 1.0, costFactor: 1.0 };
                case 'shared':
                    return { availability: 0.6, costFactor: 0.7 };
                default:
                    return { availability: 0.8, costFactor: 0.85 };
            }
        }

        function simulateMonth() {
            const warnings = [];
            let valueDelivered = 0;
            let projectsCompleted = 0;
            
            // Usar el evento ya conocido (solo desde el mes 2)
            const event = currentMonth >= 2 ? upcomingEvent : null;
            
            if (event) {
                currentEvent = event;
                applyEventEffect(event);
            }
            
            // Calcular capacidad b√°sica
            const baseProductivity = teamHealth.productivity / 100;
            const eventVariability = monthlyVariability;
            const totalMonthlyHours = teamSize * hoursPerPersonPerWeek * 4;
            
            // Procesar iniciativas
            const inProgress = initiatives.filter(i => i.status === 'in-progress');
            const backlog = initiatives.filter(i => i.status === 'backlog')
                .sort((a, b) => a.priority - b.priority);
            
            // A√±adir nuevas iniciativas al WIP basado en prioridad
            while (inProgress.length < wipLimit && backlog.length > 0) {
                const next = backlog.shift();
                next.status = 'in-progress';
                inProgress.push(next);
            }
            
            // Calcular penalizaciones
            const multiProjectPenalty = calculateMultiProjectPenalty(inProgress.length);
            
            // Calcular horas efectivas
            let effectiveHours = totalMonthlyHours * baseProductivity * eventVariability * multiProjectPenalty;
            
            // Penalizaci√≥n por WIP alto
            if (wipLimit > teamSize) {
                effectiveHours = effectiveHours * 0.55;
                warnings.push(`‚ö†Ô∏è WIP alto (${wipLimit}) reduce eficiencia dr√°sticamente`);
            }
            
            // Procesar cada iniciativa
            inProgress.forEach(initiative => {
                const teamFactor = getInitiativeTeamFactor(initiative.teamType);
                
                // Aplicar efecto de bloqueo si existe
                if (initiative.blockedWeeks > 0) {
                    initiative.blockedWeeks--;
                    warnings.push(`üöß ${initiative.name} est√° bloqueada (${initiative.blockedWeeks} semanas restantes)`);
                    return; // No procesar progreso si est√° bloqueada
                }
                
                const hoursForThisInitiative = (effectiveHours * teamFactor.availability) / Math.max(1, inProgress.length);
                
                let totalHoursNeeded = initiative.effortWeeks * 40;
                if (initiative.complexity === 'Alta') {
                    totalHoursNeeded = totalHoursNeeded * 1.3;
                }
                
                let progressIncrement = (hoursForThisInitiative / totalHoursNeeded) * 100;
                progressIncrement = progressIncrement * (0.8 + Math.random() * 0.4);
                
                initiative.progress = Math.min(100, initiative.progress + progressIncrement);
                
                if (initiative.progress >= 100) {
                    initiative.status = 'done';
                    valueDelivered += initiative.businessValue;
                    projectsCompleted++;
                }
            });
            
            // Generar advertencias
            const costs = calculateCosts();
            
            if (event) {
                warnings.unshift(`${event.icon} EVENTO: ${event.description}`);
            }
            
            if (hoursPerPersonPerWeek > 50) {
                warnings.push(`üö® SOSTENIBILIDAD: ${hoursPerPersonPerWeek}h/semana es insostenible`);
            }
            
            if (costs.totalCost > monthlyBudget * 0.9) {
                warnings.push(`üí∞ GESTI√ìN FINANCIERA: Usando ${Math.round(costs.totalCost/monthlyBudget*100)}% del presupuesto`);
            }
            
            totalValueDelivered += valueDelivered;
            monthlyVariability = 1;
            
            const finalEfficiency = Math.round((effectiveHours / totalMonthlyHours) * 100);
            
            return {
                valueDelivered,
                projectsCompleted,
                teamEfficiency: finalEfficiency,
                budgetUsed: costs.totalCost,
                warnings,
                event
            };
        }

        function executeMonth() {
            const costs = calculateCosts();

            if (monthExecuted) {
                alert('Ya ejecutaste este mes. Haz clic en "Siguiente Mes" para continuar.');
                return;
            }

            isExecuting = true;
            monthExecuted = true;
            
            // Actualizar presupuesto total acumulado
            totalBudgetUsed += costs.totalCost;
            
            // Actualizar bot√≥n
            const button = document.getElementById('executeButton');
            button.disabled = true;
            button.className = 'px-12 py-4 rounded-lg font-bold text-white text-xl bg-gray-400 cursor-not-allowed transition-colors shadow-lg';
            button.innerHTML = `
                <div class="flex items-center">
                    <div class="animate-spin mr-3 h-6 w-6 border-2 border-white border-t-transparent rounded-full"></div>
                    Ejecutando Mes ${currentMonth}...
                </div>
            `;
            
            calculateTeamImpact();
            
            setTimeout(() => {
                const results = simulateMonth();
                
                monthlyResults = results;
                monthlyHistory.push({
                    month: currentMonth,
                    ...results,
                    teamHealth: { ...teamHealth },
                    configuration: { teamSize, hoursPerPersonPerWeek, wipLimit }
                });
                
                previousTeamSize = teamSize;
                isExecuting = false;
                showResults = true;
                
                displayResults();
                updateObjectiveStatus();
                updateTeamHealthDisplay();
                renderInitiatives();
                updateBudgetDisplay();
                
                // Actualizar bot√≥n
                button.innerHTML = '‚úÖ MES EJECUTADO - Contin√∫a al siguiente mes';
                button.className = 'px-12 py-4 rounded-lg font-bold text-white text-xl bg-gray-400 cursor-not-allowed transition-colors shadow-lg';
                
                document.getElementById('executeHelp').textContent = "Mes completado. Haz clic en 'Siguiente Mes' para continuar.";
                
                // Mostrar historial si hay datos
                if (monthlyHistory.length > 0) {
                    updateHistoryDisplay();
                }
            }, 1000);
        }

        function displayResults() {
            const panel = document.getElementById('resultsPanel');
            panel.classList.remove('hidden');
            
            document.getElementById('resultsTitle').textContent = `RESULTADOS DEL MES ${currentMonth}`;
            document.getElementById('valueDeliveredResult').textContent = monthlyResults.valueDelivered;
            document.getElementById('projectsCompletedResult').textContent = monthlyResults.projectsCompleted;
            document.getElementById('efficiencyResult').textContent = `${monthlyResults.teamEfficiency}%`;
            document.getElementById('budgetUsedResult').textContent = `$${monthlyResults.budgetUsed?.toLocaleString()}`;
            
            // Actualizar panel de advertencias
            const warningsPanel = document.getElementById('warningsPanel');
            const warningsTitle = document.getElementById('warningsTitle');
            const warningsList = document.getElementById('warningsList');
            
            if (currentMonth === 1) {
                warningsPanel.className = 'border rounded-lg p-4 mb-6 bg-blue-50 border-blue-200';
                warningsTitle.className = 'font-bold text-blue-800';
                warningsTitle.textContent = 'ADVERTENCIAS DEL MES';
            } else {
                warningsPanel.className = 'border rounded-lg p-4 mb-6 bg-red-50 border-red-200';
                warningsTitle.className = 'font-bold text-red-800';
                warningsTitle.textContent = 'EVENTOS Y ADVERTENCIAS DEL MES';
            }
            
            warningsList.innerHTML = '';
            if (monthlyResults.warnings.length === 0 && currentMonth === 1) {
                warningsList.innerHTML = `
                    <li class="flex items-start text-green-700">
                        <span class="mr-2">‚Ä¢</span>
                        <span>üìÖ Mes 1 - Sin eventos. Configuraci√≥n inicial completada exitosamente.</span>
                    </li>
                `;
            } else {
                monthlyResults.warnings.forEach(warning => {
                    const li = document.createElement('li');
                    li.className = 'flex items-start text-red-700';
                    li.innerHTML = `
                        <span class="mr-2">‚Ä¢</span>
                        <span>${warning}</span>
                    `;
                    warningsList.appendChild(li);
                });
            }
            
            // Mostrar/ocultar ayuda del siguiente mes
            const nextMonthHelp = document.getElementById('nextMonthHelp');
            if (currentMonth === 1) {
                nextMonthHelp.classList.remove('hidden');
            } else {
                nextMonthHelp.classList.add('hidden');
            }
        }

        function updateHistoryDisplay() {
            const panel = document.getElementById('historyPanel');
            panel.classList.remove('hidden');
            
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';
            
            monthlyHistory.forEach(history => {
                const row = document.createElement('tr');
                row.className = 'border-t';
                
                const eventDisplay = history.event ? 
                    `<div class="flex items-center">
                        <span class="mr-2">${history.event.icon}</span>
                        <div>
                            <div class="text-xs">${history.event.name}</div>
                            <div class="text-xs px-1 py-0.5 rounded mt-1 inline-block ${
                                history.event.type === 'positive' ? 'bg-green-100 text-green-700' :
                                history.event.type === 'negative' ? 'bg-red-100 text-red-700' :
                                'bg-blue-100 text-blue-700'
                            }">
                                ${history.event.type === 'positive' ? '+' :
                                  history.event.type === 'negative' ? '-' : '~'}
                            </div>
                        </div>
                    </div>` :
                    `<div class="flex items-center">
                        <span class="mr-2">üìÖ</span>
                        <div class="text-xs">Sin evento</div>
                    </div>`;
                
                row.innerHTML = `
                    <td class="px-4 py-3 font-bold">${history.month}</td>
                    <td class="px-4 py-3">${eventDisplay}</td>
                    <td class="px-4 py-3 font-bold text-green-600">${history.valueDelivered}</td>
                    <td class="px-4 py-3 text-center">${history.projectsCompleted}</td>
                    <td class="px-4 py-3 text-center">${history.teamEfficiency}%</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function nextMonth() {
            const newMonth = currentMonth + 1;
            currentMonth = newMonth;
            showResults = false;
            currentEvent = null;
            monthExecuted = false;
            
            // Actualizar display
            document.getElementById('currentMonthDisplay').textContent = `MES ${currentMonth}`;
            document.getElementById('resultsPanel').classList.add('hidden');
            
            // Restablecer bot√≥n
            const button = document.getElementById('executeButton');
            button.disabled = false;
            button.className = 'px-12 py-4 rounded-lg font-bold text-white text-xl bg-amber-500 hover:bg-amber-600 transition-colors shadow-lg';
            button.innerHTML = `
                <div class="flex items-center">
                    <svg class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="5,3 19,12 5,21 5,3"/>
                    </svg>
                    EJECUTAR MES ${currentMonth}
                </div>
            `;
            
            // Generar evento para el pr√≥ximo mes (solo desde el mes 2 en adelante)
            if (newMonth >= 2 && newMonth <= targetMonths) {
                generateUpcomingEvent();
            } else {
                hideEventPanel();
            }
            
            // Actualizar texto de ayuda
            if (currentMonth === 1) {
                document.getElementById('executeHelp').textContent = "Configura tu equipo, prioriza iniciativas y ejecuta tu primer mes";
            } else if (currentMonth <= targetMonths) {
                document.getElementById('executeHelp').textContent = "Configura tu equipo, revisa el evento del mes y ejecuta";
            }
            
            // Si completamos los 6 meses, mostrar resumen autom√°ticamente
            if (newMonth > targetMonths) {
                setTimeout(() => {
                    showProfessionalSummary = true;
                    displayProfessionalSummary();
                }, 500);
            }
            
            // Manejar rotaci√≥n del equipo
            if (teamHealth.turnover > 30) {
                const peopleLeaving = Math.floor(teamSize * teamHealth.turnover / 100 / 2);
                if (peopleLeaving > 0) {
                    const newTeamSize = Math.max(1, teamSize - peopleLeaving);
                    teamSize = newTeamSize;
                    
                    // Actualizar slider
                    document.getElementById('teamSizeSlider').value = teamSize;
                    updateTeamSize(teamSize);
                    
                    teamHealth = {
                        ...teamHealth,
                        turnover: Math.max(0, teamHealth.turnover - 20),
                        productivity: Math.max(60, teamHealth.productivity - 15),
                        satisfaction: Math.max(40, teamHealth.satisfaction - 10)
                    };
                }
            }
            
            updateBudgetDisplay();
            updateObjectiveStatus();
            updateTeamHealthDisplay();
            renderInitiatives();
        }

        function resetSimulation() {
            // Resetear todas las variables
            currentMonth = 1;
            showResults = false;
            showProfessionalSummary = false;
            monthlyHistory = [];
            totalValueDelivered = 0;
            totalBudgetUsed = 0;
            teamSize = 5;
            hoursPerPersonPerWeek = 40;
            wipLimit = 2;
            previousTeamSize = 5;
            currentEvent = null;
            upcomingEvent = null;
            lastEventType = null;
            monthlyVariability = 1;
            monthExecuted = false;
            
            teamHealth = {
                burnoutLevel: 0,
                satisfaction: 100,
                turnover: 0,
                productivity: 100
            };
            
            // Randomizar iniciativas
            const complexityOptions = ['Alta', 'Baja'];
            const alignmentOptions = ['Cr√≠tico', 'Alto', 'Medio', 'Bajo'];
            const teamTypeOptions = ['dedicated', 'shared'];
            
            initiatives = [
                {
                    id: 1,
                    name: 'Plataforma E-commerce',
                    businessValue: 110 + Math.round(Math.random() * 30),
                    effortWeeks: 12 + Math.round(Math.random() * 6),
                    originalEffort: 14,
                    strategicAlignment: alignmentOptions[Math.floor(Math.random() * alignmentOptions.length)],
                    complexity: complexityOptions[Math.floor(Math.random() * complexityOptions.length)],
                    teamType: teamTypeOptions[Math.floor(Math.random() * teamTypeOptions.length)],
                    status: 'backlog',
                    progress: 0,
                    priority: 1,
                    blockedWeeks: 0,
                    hasIssues: false
                },
                {
                    id: 2,
                    name: 'App Mobile',
                    businessValue: 80 + Math.round(Math.random() * 25),
                    effortWeeks: 8 + Math.round(Math.random() * 4),
                    originalEffort: 10,
                    strategicAlignment: alignmentOptions[Math.floor(Math.random() * alignmentOptions.length)],
                    complexity: complexityOptions[Math.floor(Math.random() * complexityOptions.length)],
                    teamType: teamTypeOptions[Math.floor(Math.random() * teamTypeOptions.length)],
                    status: 'backlog',
                    progress: 0,
                    priority: 2,
                    blockedWeeks: 0,
                    hasIssues: false
                },
                {
                    id: 3,
                    name: 'Sistema CRM',
                    businessValue: 65 + Math.round(Math.random() * 20),
                    effortWeeks: 10 + Math.round(Math.random() * 4),
                    originalEffort: 12,
                    strategicAlignment: alignmentOptions[Math.floor(Math.random() * alignmentOptions.length)],
                    complexity: complexityOptions[Math.floor(Math.random() * complexityOptions.length)],
                    teamType: teamTypeOptions[Math.floor(Math.random() * teamTypeOptions.length)],
                    status: 'backlog',
                    progress: 0,
                    priority: 3,
                    blockedWeeks: 0,
                    hasIssues: false
                },
                {
                    id: 4,
                    name: 'Automatizaci√≥n QA',
                    businessValue: 50 + Math.round(Math.random() * 20),
                    effortWeeks: 6 + Math.round(Math.random() * 4),
                    originalEffort: 8,
                    strategicAlignment: alignmentOptions[Math.floor(Math.random() * alignmentOptions.length)],
                    complexity: complexityOptions[Math.floor(Math.random() * complexityOptions.length)],
                    teamType: teamTypeOptions[Math.floor(Math.random() * teamTypeOptions.length)],
                    status: 'backlog',
                    progress: 0,
                    priority: 4,
                    blockedWeeks: 0,
                    hasIssues: false
                },
                {
                    id: 5,
                    name: 'Refactoring Backend',
                    businessValue: 35 + Math.round(Math.random() * 20),
                    effortWeeks: 4 + Math.round(Math.random() * 4),
                    originalEffort: 6,
                    strategicAlignment: alignmentOptions[Math.floor(Math.random() * alignmentOptions.length)],
                    complexity: complexityOptions[Math.floor(Math.random() * complexityOptions.length)],
                    teamType: teamTypeOptions[Math.floor(Math.random() * teamTypeOptions.length)],
                    status: 'backlog',
                    progress: 0,
                    priority: 5,
                    blockedWeeks: 0,
                    hasIssues: false
                },
                {
                    id: 6,
                    name: 'Analytics Dashboard',
                    businessValue: 55 + Math.round(Math.random() * 20),
                    effortWeeks: 7 + Math.round(Math.random() * 4),
                    originalEffort: 9,
                    strategicAlignment: alignmentOptions[Math.floor(Math.random() * alignmentOptions.length)],
                    complexity: complexityOptions[Math.floor(Math.random() * complexityOptions.length)],
                    teamType: teamTypeOptions[Math.floor(Math.random() * teamTypeOptions.length)],
                    status: 'backlog',
                    progress: 0,
                    priority: 6,
                    blockedWeeks: 0,
                    hasIssues: false
                }
            ];
            
            // Resetear UI
            document.getElementById('currentMonthDisplay').textContent = 'MES 1';
            document.getElementById('resultsPanel').classList.add('hidden');
            document.getElementById('historyPanel').classList.add('hidden');
            document.getElementById('professionalSummaryModal').classList.add('hidden');
            hideEventPanel();
            
            // Resetear sliders
            document.getElementById('teamSizeSlider').value = 5;
            document.getElementById('hoursSlider').value = 40;
            document.getElementById('wipSlider').value = 2;
            
            // Resetear bot√≥n
            const button = document.getElementById('executeButton');
            button.disabled = false;
            button.className = 'px-12 py-4 rounded-lg font-bold text-white text-xl bg-amber-500 hover:bg-amber-600 transition-colors shadow-lg';
            button.innerHTML = `
                <div class="flex items-center">
                    <svg class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="5,3 19,12 5,21 5,3"/>
                    </svg>
                    EJECUTAR MES 1
                </div>
            `;
            
            document.getElementById('executeHelp').textContent = "Configura tu equipo, prioriza iniciativas y ejecuta tu primer mes";
            
            // Actualizar displays
            updateTeamSize(5);
            updateHours(40);
            updateWip(2);
            updateBudgetDisplay();
            updateObjectiveStatus();
            updateTeamHealthDisplay();
            renderInitiatives();
        }

        function displayProfessionalSummary() {
            const modal = document.getElementById('professionalSummaryModal');
            const content = document.getElementById('professionalSummaryContent');
            
            // Generar contenido del resumen
            const summary = generateProfessionalSummary();
            content.innerHTML = summary;
            
            modal.classList.remove('hidden');
        }

        function closeProfessionalSummary() {
            document.getElementById('professionalSummaryModal').classList.add('hidden');
        }

        function generateProfessionalSummary() {
            if (monthlyHistory.length === 0) return '';
            
            const totalBudgetAvailable = targetMonths * monthlyBudget;
            const budgetEfficiency = (totalBudgetUsed / totalBudgetAvailable) * 100;
            
            const avgEfficiency = Math.round(monthlyHistory.reduce((acc, month) => acc + month.teamEfficiency, 0) / monthlyHistory.length);
            const totalProjectsCompleted = monthlyHistory.reduce((acc, month) => acc + month.projectsCompleted, 0);
            const achievementPercentage = Math.round((totalValueDelivered / targetValue) * 100);
            
            const avgBurnout = Math.round(monthlyHistory.reduce((acc, month) => acc + (month.teamHealth?.burnoutLevel || 0), 0) / monthlyHistory.length);
            const avgSatisfaction = Math.round(monthlyHistory.reduce((acc, month) => acc + (month.teamHealth?.satisfaction || 100), 0) / monthlyHistory.length);
            
            // Generar score
            const scoreComponents = {
                valueDelivery: Math.min(100, (achievementPercentage / 90) * 25),
                efficiency: (avgEfficiency / 100) * 25,
                sustainability: Math.max(0, (100 - avgBurnout) / 100) * 25,
                budgetManagement: Math.max(0, (100 - budgetEfficiency) / 100) * 25
            };
            
            const overallScore = Math.round(
                scoreComponents.valueDelivery + 
                scoreComponents.efficiency + 
                scoreComponents.sustainability + 
                scoreComponents.budgetManagement
            );
            
            const budgetPenalty = totalBudgetUsed > totalBudgetAvailable ? 15 : 0;
            const finalScore = Math.max(0, overallScore - budgetPenalty);
            
            return `
                <!-- Resultado Final del Desaf√≠o -->
                <div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-lg p-6 mb-8">
                    <div class="flex items-center justify-center mb-4">
                        <svg class="text-amber-600 mr-2" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
                            <path d="M14 9h1.5a2.5 2.5 0 0 1 0 5H14"/>
                            <path d="M6 2v6"/>
                            <path d="M14 2v6"/>
                            <path d="M6 16v6"/>
                            <path d="M14 16v6"/>
                            <path d="M6 16h8"/>
                            <path d="M6 9h8"/>
                        </svg>
                        <h2 class="text-xl font-bold text-amber-900">RESULTADO FINAL DEL DESAF√çO</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center mb-6">
                        <div class="bg-white rounded-lg p-4 border border-amber-100">
                            <div class="text-2xl font-bold text-amber-600">${totalValueDelivered}/${targetValue}</div>
                            <div class="text-sm text-gray-600">Valor de Negocio Entregado</div>
                            <div class="text-xs text-gray-500">Meta: ${targetValue} puntos</div>
                        </div>
                        <div class="bg-white rounded-lg p-4 border border-amber-100">
                            <div class="text-2xl font-bold text-amber-600">${currentMonth}/${targetMonths}</div>
                            <div class="text-sm text-gray-600">Meses Completados</div>
                            <div class="text-xs text-gray-500">Tiempo total del proyecto</div>
                        </div>
                        <div class="bg-white rounded-lg p-4 border border-amber-100">
                            <div class="text-2xl font-bold ${totalBudgetUsed > totalBudgetAvailable ? 'text-red-600' : 'text-green-600'}">
                                $${totalBudgetUsed.toLocaleString()}
                            </div>
                            <div class="text-sm text-gray-600">Presupuesto Total Usado</div>
                            <div class="text-xs text-gray-500">L√≠mite: $${totalBudgetAvailable.toLocaleString()}</div>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="text-lg font-medium ${totalValueDelivered >= targetValue ? 'text-green-600' : 'text-red-600'}">
                            ${totalValueDelivered >= targetValue ? 'üéâ ¬°OBJETIVO ALCANZADO!' : `‚ùå OBJETIVO NO ALCANZADO - ${achievementPercentage}% completado`}
                        </div>
                        ${totalBudgetUsed > totalBudgetAvailable ? 
                            `<div class="text-sm text-red-600 mt-2">
                                ‚ö†Ô∏è Presupuesto excedido por $${(totalBudgetUsed - totalBudgetAvailable).toLocaleString()}
                            </div>` : ''
                        }
                    </div>
                </div>

                ${totalBudgetUsed > totalBudgetAvailable ? `
                    <!-- Consecuencias del Presupuesto Excedido -->
                    <div class="bg-red-50 rounded-lg p-6 border border-red-200 mb-8">
                        <h3 class="text-xl font-bold text-red-900 mb-4 flex items-center">
                            <span class="mr-2">üí∞</span>
                            Consecuencias del Presupuesto Excedido
                        </h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-white rounded border border-red-100">
                                <h4 class="font-semibold text-red-900 mb-2">Impacto Financiero</h4>
                                <ul class="text-sm text-red-800 space-y-1">
                                    <li>‚Ä¢ Exceso presupuestal: $${(totalBudgetUsed - totalBudgetAvailable).toLocaleString()}</li>
                                    <li>‚Ä¢ Porcentaje de exceso: ${Math.round(((totalBudgetUsed - totalBudgetAvailable) / totalBudgetAvailable) * 100)}%</li>
                                    <li>‚Ä¢ Esto representa un sobrecosto significativo del proyecto</li>
                                </ul>
                            </div>
                            <div class="p-4 bg-white rounded border border-red-100">
                                <h4 class="font-semibold text-red-900 mb-2">Lecciones Aprendidas</h4>
                                <ul class="text-sm text-red-800 space-y-1">
                                    <li>‚Ä¢ La flexibilidad presupuestal debe usarse estrat√©gicamente</li>
                                    <li>‚Ä¢ El control de costos es crucial en la gesti√≥n de portafolios</li>
                                    <li>‚Ä¢ Los eventos disruptivos requieren decisiones financieras cuidadosas</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                ` : ''}

                <!-- Score General -->
                <div class="bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg p-6 border border-amber-200 mb-8">
                    <div class="text-center mb-6">
                        <div class="text-6xl font-bold text-amber-600 mb-2">
                            ${finalScore}/100
                        </div>
                        <div class="text-xl font-semibold text-amber-800">
                            ${finalScore >= 85 ? 'Excelente Gesti√≥n' : 
                              finalScore >= 70 ? 'Buena Gesti√≥n' : 
                              finalScore >= 55 ? 'Gesti√≥n Promedio' : 'Oportunidad de Mejora'}
                        </div>
                        <div class="text-sm text-amber-700 mt-2">
                            Puntuaci√≥n General de Lean Portfolio Management
                            ${budgetPenalty > 0 ? `<div class="text-red-600 mt-1">(-${budgetPenalty} puntos por exceso presupuestal)</div>` : ''}
                        </div>
                    </div>
                </div>

                <!-- Historial Completo -->
                <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                    <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                        <span class="mr-2">üìä</span>
                        Historial Completo de la Simulaci√≥n
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-4 py-3 text-left font-medium text-gray-700">Mes</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-700">Evento</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-700">Valor Entregado</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-700">Completadas</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-700">Eficiencia</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-700">Presupuesto</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-700">Salud del Equipo</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${monthlyHistory.map(history => `
                                    <tr class="border-t border-gray-200">
                                        <td class="px-4 py-3 font-bold text-gray-900">${history.month}</td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center">
                                                <span class="mr-2">${history.event?.icon || 'üìÖ'}</span>
                                                <div>
                                                    <div class="text-xs font-medium text-gray-700">${history.event?.name || 'Sin evento'}</div>
                                                    ${history.event?.type ? `
                                                        <div class="text-xs px-2 py-1 rounded mt-1 inline-block ${
                                                            history.event.type === 'positive' ? 'bg-green-100 text-green-700' :
                                                            history.event.type === 'negative' ? 'bg-red-100 text-red-700' :
                                                            'bg-blue-100 text-blue-700'
                                                        }">
                                                            ${history.event.type === 'positive' ? 'Positivo' :
                                                              history.event.type === 'negative' ? 'Negativo' :
                                                              'Neutro'}
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-4 py-3 font-bold text-green-600">${history.valueDelivered}</td>
                                        <td class="px-4 py-3 text-center text-gray-700">${history.projectsCompleted}</td>
                                        <td class="px-4 py-3 text-center text-gray-700">${history.teamEfficiency}%</td>
                                        <td class="px-4 py-3 text-center text-gray-700">$${history.budgetUsed?.toLocaleString()}</td>
                                        <td class="px-4 py-3 text-center">
                                            <div class="text-xs">
                                                <div class="${history.teamHealth?.burnoutLevel >= 70 ? 'text-red-600' : history.teamHealth?.burnoutLevel >= 40 ? 'text-yellow-600' : 'text-green-600'}">
                                                    Burnout: ${history.teamHealth?.burnoutLevel || 0}%
                                                </div>
                                                <div class="${history.teamHealth?.productivity >= 80 ? 'text-green-600' : history.teamHealth?.productivity >= 60 ? 'text-yellow-600' : 'text-red-600'}">
                                                    Productividad: ${history.teamHealth?.productivity || 100}%
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white p-4 rounded-lg border border-gray-200">
                            <h4 class="font-semibold text-gray-900 mb-2">Valor Total Entregado</h4>
                            <div class="text-2xl font-bold text-green-600">
                                ${totalValueDelivered}
                            </div>
                            <div class="text-sm text-gray-600">de ${targetValue} objetivo</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200">
                            <h4 class="font-semibold text-gray-900 mb-2">Eficiencia Promedio</h4>
                            <div class="text-2xl font-bold text-blue-600">
                                ${avgEfficiency}%
                            </div>
                            <div class="text-sm text-gray-600">del equipo</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200">
                            <h4 class="font-semibold text-gray-900 mb-2">Presupuesto Total</h4>
                            <div class="text-2xl font-bold ${totalBudgetUsed > totalBudgetAvailable ? 'text-red-600' : 'text-green-600'}">
                                $${totalB